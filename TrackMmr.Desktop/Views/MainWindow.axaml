<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TrackMmr.Desktop.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
        xmlns:asyncImageLoader="clr-namespace:AsyncImageLoader;assembly=AsyncImageLoader.Avalonia"
        xmlns:conv="using:TrackMmr.Desktop.Converters"
        mc:Ignorable="d" d:DesignWidth="1100" d:DesignHeight="800"
        x:Class="TrackMmr.Desktop.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Dota 2 MMR Tracker"
        Width="1100" Height="800"
        Background="Transparent"
        TransparencyLevelHint="AcrylicBlur"
        ExtendClientAreaToDecorationsHint="True">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Resources>
        <conv:IntToBoolConverter x:Key="IntToBoolConverter"/>
    </Window.Resources>

    <Window.Styles>
        <Style Selector="Border.Card">
            <Setter Property="Background" Value="#CC252525"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="BoxShadow" Value="0 8 24 0 #30000000"/>
        </Style>
        <Style Selector="ListBoxItem">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>
        <Style Selector="RadioButton.NavButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="Margin" Value="0,2"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Foreground" Value="#999"/>
            <Setter Property="Template">
                <ControlTemplate>
                    <Border Background="{TemplateBinding Background}"
                            CornerRadius="8"
                            Padding="{TemplateBinding Padding}">
                        <ContentPresenter Content="{TemplateBinding Content}"/>
                    </Border>
                </ControlTemplate>
            </Setter>
        </Style>
        <Style Selector="RadioButton.NavButton:pointerover">
            <Setter Property="Background" Value="#15FFFFFF"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style Selector="RadioButton.NavButton:checked">
            <Setter Property="Background" Value="#25FFFFFF"/>
            <Setter Property="Foreground" Value="DodgerBlue"/>
        </Style>
    </Window.Styles>

    <Panel>
        <ExperimentalAcrylicBorder IsHitTestVisible="False">
            <ExperimentalAcrylicBorder.Material>
                <ExperimentalAcrylicMaterial
                    BackgroundSource="Digger"
                    TintColor="Black"
                    TintOpacity="0.9"
                    MaterialOpacity="0.8" />
            </ExperimentalAcrylicBorder.Material>
        </ExperimentalAcrylicBorder>

        <Grid ColumnDefinitions="260, *">
            <Border Grid.Column="0" BorderBrush="#20FFFFFF" BorderThickness="0,0,1,0" Padding="20,50,20,20">
                <Grid RowDefinitions="Auto, *, Auto">
                    <StackPanel Grid.Row="0" Spacing="5" Margin="0,0,0,40">
                        <TextBlock Text="TRACK MMR" FontSize="24" FontWeight="Black" Foreground="DodgerBlue" LetterSpacing="2"/>
                        <TextBlock Text="Dota 2 Analytics" FontSize="11" Foreground="#555" FontWeight="Bold"/>
                    </StackPanel>

                    <StackPanel Grid.Row="1" Spacing="5">
                        <RadioButton Classes="NavButton" IsChecked="{Binding CurrentPageIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=0}">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <PathIcon Data="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" Width="18"/>
                                <TextBlock Text="Dashboard" VerticalAlignment="Center" FontWeight="SemiBold"/>
                            </StackPanel>
                        </RadioButton>
                        <RadioButton Classes="NavButton" IsChecked="{Binding CurrentPageIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=1}">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <PathIcon Data="M13 3H7c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V9l-6-6zm0 1.5L17.5 9H13V4.5zM17 19H7V5h5v5h5v9z" Width="18"/>
                                <TextBlock Text="Matches" VerticalAlignment="Center" FontWeight="SemiBold"/>
                            </StackPanel>
                        </RadioButton>
                        <RadioButton Classes="NavButton" IsChecked="{Binding CurrentPageIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=2}">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <PathIcon Data="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z" Width="18"/>
                                <TextBlock Text="Statistics" VerticalAlignment="Center" FontWeight="SemiBold"/>
                            </StackPanel>
                        </RadioButton>
                    </StackPanel>

                    <Border Grid.Row="2" Classes="Card" Background="#10FFFFFF" Padding="15">
                        <StackPanel Spacing="10">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <Ellipse Width="8" Height="8" Fill="#4CAF50"/>
                                <TextBlock Text="Steam Connected" FontSize="11" Foreground="#888"/>
                            </StackPanel>
                            <Button Command="{Binding FetchMmrCommand}" IsEnabled="{Binding !IsBusy}" HorizontalAlignment="Stretch" Background="#30FFFFFF">
                                <TextBlock Text="Sync Data" HorizontalAlignment="Center" FontSize="12" FontWeight="Bold"/>
                            </Button>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <Grid Grid.Column="1" RowDefinitions="Auto, *">
                <Border Grid.Row="0" Height="50"/>

                <Carousel Grid.Row="1" SelectedIndex="{Binding CurrentPageIndex}">
                    <Carousel.PageTransition>
                        <PageSlide Duration="0:0:0.3" Orientation="Vertical" />
                    </Carousel.PageTransition>

                    <ScrollViewer>
                        <StackPanel Margin="40,0,40,40" Spacing="30">
                            <Grid ColumnDefinitions="*, *">
                                <StackPanel Spacing="5">
                                    <TextBlock Text="Welcome back," FontSize="14" Foreground="#777"/>
                                    <StackPanel Orientation="Horizontal" Spacing="15">
                                        <TextBlock Text="{Binding CurrentMmr}" FontSize="64" FontWeight="Black" Foreground="White"/>
                                        <TextBlock Text="MMR" FontSize="20" FontWeight="Bold" Foreground="DodgerBlue" VerticalAlignment="Bottom" Margin="0,0,0,12"/>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>

                            <Border Classes="Card">
                                <StackPanel Spacing="20">
                                    <TextBlock Text="Performance Trend" FontSize="16" FontWeight="Bold"/>
                                    <lvc:CartesianChart Height="350" Series="{Binding MmrSeries}" XAxes="{Binding XAxes}" YAxes="{Binding YAxes}" />
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <Grid RowDefinitions="Auto, *">
                        <TextBlock Grid.Row="0" Text="Match History" FontSize="28" FontWeight="Black" Margin="40,20,40,20"/>
                        <ListBox Grid.Row="1" ItemsSource="{Binding Matches}" Background="Transparent" Margin="20,0">
                            <ListBox.ItemTemplate>
                                <DataTemplate x:DataType="vm:MatchRowViewModel">
                                    <Border Classes="Card" Margin="10,5" Padding="15">
                                        <Grid ColumnDefinitions="Auto, *, Auto, Auto, 100">
                                            <Border Grid.Column="0" CornerRadius="4" ClipToBounds="True" Margin="0,0,20,0">
                                                <Image asyncImageLoader:ImageLoader.Source="{Binding HeroIconUrl}" Width="60" Height="34" Stretch="UniformToFill"/>
                                            </Border>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Hero}" FontSize="16" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding Date}" FontSize="12" Foreground="#666"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="0,0,40,0" HorizontalAlignment="Right">
                                                <TextBlock Text="{Binding Mmr}" FontSize="18" FontWeight="Black" HorizontalAlignment="Right"/>
                                                <TextBlock Text="MMR" FontSize="9" FontWeight="Bold" Foreground="#444" HorizontalAlignment="Right"/>
                                            </StackPanel>
                                            <TextBlock Grid.Column="3" Text="{Binding MmrChange}" Foreground="{Binding ResultBrush}" FontSize="18" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,40,0"/>
                                            <Border Grid.Column="4" Background="{Binding ResultBrush}" CornerRadius="20" Padding="12,4" HorizontalAlignment="Stretch">
                                                <TextBlock Text="{Binding Result}" HorizontalAlignment="Center" FontWeight="Black" FontSize="12" Foreground="White"/>
                                            </Border>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>

                    <ScrollViewer>
                        <StackPanel Margin="40,20,40,40" Spacing="20">
                            <TextBlock Text="Hero Statistics" FontSize="28" FontWeight="Black" Margin="0,0,0,10"/>
                            <ItemsControl ItemsSource="{Binding HeroStats}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="vm:HeroStatViewModel">
                                        <Border Classes="Card" Margin="0,0,0,10" Padding="15">
                                            <Grid ColumnDefinitions="50, *, 100, 100, 100">
                                                <Border Grid.Column="0" CornerRadius="4" ClipToBounds="True" Width="40" Height="22">
                                                    <Image asyncImageLoader:ImageLoader.Source="{Binding IconUrl}" Stretch="UniformToFill"/>
                                                </Border>
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="15,0">
                                                    <TextBlock Text="{Binding HeroName}" FontSize="16" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding TotalGames, StringFormat='\{0\} Matches'}" FontSize="12" Foreground="#666"/>
                                                </StackPanel>
                                                <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                                    <TextBlock Text="Winrate" FontSize="10" Foreground="#555" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding WinRateDisplay}" FontSize="16" FontWeight="Bold"/>
                                                </StackPanel>
                                                <StackPanel Grid.Column="3" VerticalAlignment="Center">
                                                    <TextBlock Text="Wins / Losses" FontSize="10" Foreground="#555" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding Wins}" FontSize="16" FontWeight="Bold"/>
                                                </StackPanel>
                                                <StackPanel Grid.Column="4" VerticalAlignment="Center" HorizontalAlignment="Right">
                                                    <TextBlock Text="Net MMR" FontSize="10" Foreground="#555" FontWeight="Bold" HorizontalAlignment="Right"/>
                                                    <TextBlock Text="{Binding MmrChangeDisplay}" Foreground="{Binding MmrBrush}" FontSize="18" FontWeight="Black" HorizontalAlignment="Right"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </ScrollViewer>
                </Carousel>
            </Grid>
        </Grid>

        <Border IsVisible="{Binding NeedsLogin}" Background="#EE000000" ZIndex="100">
            <Border Classes="Card" Width="400" Margin="40" VerticalAlignment="Center">
                <StackPanel Spacing="20">
                    <TextBlock Text="Steam Login" FontSize="24" FontWeight="Black" HorizontalAlignment="Center"/>
                    <TextBox Text="{Binding Username}" Watermark="Username" Height="45"/>
                    <TextBox Text="{Binding Password}" Watermark="Password" PasswordChar="â—" Height="45"/>
                    <Button Command="{Binding LoginAndFetchCommand}" Content="Login" HorizontalAlignment="Stretch" Height="45" Classes="accent"/>
                    <TextBlock Text="{Binding StatusText}" Foreground="#F44336" FontSize="12" HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Border>

        <Border IsVisible="{Binding IsBusy}" Background="#AA000000" ZIndex="50">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="20">
                <ProgressBar IsIndeterminate="True" Width="200" Foreground="DodgerBlue"/>
                <TextBlock Text="{Binding StatusText}" FontWeight="Bold"/>
            </StackPanel>
        </Border>
    </Panel>
</Window>
